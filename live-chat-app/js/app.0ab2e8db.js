(function(t){function e(e){for(var a,c,o=e[0],r=e[1],l=e[2],h=0,d=[];h<o.length;h++)c=o[h],Object.prototype.hasOwnProperty.call(s,c)&&s[c]&&d.push(s[c][0]),s[c]=0;for(a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a]);u&&u(e);while(d.length)d.shift()();return i.push.apply(i,l||[]),n()}function n(){for(var t,e=0;e<i.length;e++){for(var n=i[e],a=!0,o=1;o<n.length;o++){var r=n[o];0!==s[r]&&(a=!1)}a&&(i.splice(e--,1),t=c(c.s=n[0]))}return t}var a={},s={app:0},i=[];function c(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,c),n.l=!0,n.exports}c.m=t,c.c=a,c.d=function(t,e,n){c.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},c.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},c.t=function(t,e){if(1&e&&(t=c(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(c.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)c.d(n,a,function(e){return t[e]}.bind(null,a));return n},c.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return c.d(e,"a",e),e},c.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},c.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],r=o.push.bind(o);o.push=e,o=o.slice();for(var l=0;l<o.length;l++)e(o[l]);var u=r;i.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"034f":function(t,e,n){"use strict";var a=n("85ec"),s=n.n(a);s.a},"0dd7":function(t,e,n){},"2fb3":function(t,e,n){},3043:function(t,e,n){},3171:function(t,e,n){},"3a3f":function(t,e,n){},"413b":function(t,e,n){"use strict";var a=n("3171"),s=n.n(a);s.a},"4f97":function(t,e,n){},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var a=n("2b0e"),s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("router-view")],1)},i=[],c={name:"App"},o=c,r=(n("034f"),n("2877")),l=Object(r["a"])(o,s,i,!1,null,null,null),u=l.exports,h=n("8c4f"),d=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"wrapper"},[t._m(0),n("div",{staticClass:"wrapper__content"},[n("p",[t._v("You can open the admin panel and reply to messages "),n("router-link",{staticClass:"wrapper__btn-inline",attrs:{to:"/admin"}},[t._v("Admin panel")])],1),n("p",[t._v("Login: usertest@test.test")]),n("p",[t._v("Password: usertest")])]),n("div",{staticClass:"wrapper__blocks"},t._l(9,(function(t){return n("div",{key:t,staticClass:"wrapper__block"})})),0)]),n("LiveChat")],1)},p=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"wrapper__head"},[n("h2",{staticClass:"wrapper__header"},[t._v("Home page")])])}],f=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"live-chat"},[n("ChatToggle",{attrs:{isOpen:t.isOpen,isNewMsg:t.isNewMsg},on:{"render-chat":t.renderChat,"open-chat":t.openChat}}),t.isRender?n("div",{staticClass:"chat-box",class:{"chat-box_open":t.isOpen}},[n("ChatHead",{on:{"open-chat":t.openChat}}),n("ChatList",{attrs:{chat:t.chat,showRead:!1}}),t.infoAlert.show?n("ChatInfo",{attrs:{info:t.infoAlert}}):t._e(),n("ChatFooter",{on:{"send-msg":t.sendMsg}})],1):t._e()],1)},v=[],_=(n("99af"),n("d81d"),n("45fc"),n("5530")),g=n("2909"),m=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("button",{staticClass:"livechat-btn chat-toggle",class:{"chat-toggle_new-msg":t.isNewMsg},on:{"~click":function(e){return t.$emit("render-chat")},click:function(e){return t.$emit("open-chat")}}},[n("i",{directives:[{name:"show",rawName:"v-show",value:t.isOpen,expression:"isOpen"}],staticClass:"livechat-icon-close"}),n("svg",{directives:[{name:"show",rawName:"v-show",value:!t.isOpen,expression:"!isOpen"}],staticClass:"icon-logo",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"}},[n("g",{staticClass:"icon-logo__figure"},[n("path",{attrs:{d:"M4,28a.84.84,0,0,1-.38-.08A1,1,0,0,1,3,27V8.78A4.89,4.89,0,0,1,8,4H24a4.89,4.89,0,0,1,5,4.78v9.44A4.89,4.89,0,0,1,24,23H9.41l-4.7,4.71A1,1,0,0,1,4,28ZM8,6A2.9,2.9,0,0,0,5,8.78V24.59l3.29-3.3A1,1,0,0,1,9,21H24a2.9,2.9,0,0,0,3-2.78V8.78A2.9,2.9,0,0,0,24,6Z"}}),n("circle",{attrs:{cx:"16",cy:"13.5",r:"1.5"}}),n("circle",{attrs:{cx:"21.5",cy:"13.5",r:"1.5"}}),n("circle",{attrs:{cx:"10.5",cy:"13.5",r:"1.5"}})]),n("g",[n("rect",{attrs:{height:"32",width:"32"}})])])])},b=[],C={props:["isOpen","isNewMsg"]},w=C,x=(n("c885"),Object(r["a"])(w,m,b,!1,null,"f13e4624",null)),O=x.exports,D=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"chat-box__head"},[n("div",{staticClass:"chat-box__title"},[t._v("LiveChat")]),n("button",{staticClass:"livechat-btn chat-box__btn-close",attrs:{title:"Close"},on:{click:function(e){return t.$emit("open-chat")}}},[n("i",{staticClass:"livechat-icon-close livechat-icon-close_head"})])])},A=[],y=(n("cf16"),{}),I=Object(r["a"])(y,D,A,!1,null,"38c1f818",null),j=I.exports,k=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"chatList",staticClass:"chat-box__list"},t._l(t.chat,(function(e){return n("div",{key:e.id,staticClass:"chat-box__msg-block",class:{"chat-box__msg-block_sent":"user"===e.author}},[n("div",{staticClass:"chat-box__msg-text"},[n("div",[t._v(t._s(e.text))]),n("div",{staticClass:"chat-box__msg-date"},[t.showRead?n("span",{class:["msg-status",e.read?"msg-status_read":"msg-status_unread"],attrs:{title:e.read?"Read message":"Unread message"}}):t._e(),t._v(" "+t._s(t._f("formatDate")(e.date))+" ")])])])})),0)},B=[],L=function(t){return t<10?"0"+t:t},M={props:["chat","showRead"],mounted:function(){this.scrollToBottom()},updated:function(){this.scrollToBottom()},methods:{scrollToBottom:function(){this.$refs.chatList.scrollTop=this.$refs.chatList.scrollHeight}},filters:{formatDate:function(t){var e=new Date(+t),n=L(e.getDate()),a=L(e.getMonth()+1),s=e.getFullYear(),i=L(e.getHours()),c=L(e.getMinutes());return"".concat(n,".").concat(a,".").concat(s," ").concat(i,":").concat(c)}}},$=M,E=(n("c8e3"),Object(r["a"])($,k,B,!1,null,"7e899dd2",null)),R=E.exports,S=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:"chat-info chat-info_"+t.info.type},[t._v(t._s(t.info.text))])},T=[],P={props:["info"]},N=P,G=(n("b26d"),Object(r["a"])(N,S,T,!1,null,"f1321cb6",null)),H=G.exports,z=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"chat-box__footer"},[n("div",{ref:"textInput",staticClass:"chat-box__input",attrs:{contenteditable:"true",tabindex:"0",placeholder:"Write a message"},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.sendText(e))}}}),n("div",{staticClass:"chat-box__options"},[n("button",{staticClass:"livechat-btn chat-box__btn-send",attrs:{title:"Send"},on:{click:t.sendText}},[n("svg",{staticClass:"icon-send",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"}},[n("path",{attrs:{d:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"}})])])])])},F=[],J=(n("498a"),{methods:{sendText:function(){this.$refs.textInput.innerText.trim().length>0&&(this.$emit("send-msg",this.$refs.textInput.innerText),this.$refs.textInput.innerText="")}}}),V=J,U=(n("cce6"),Object(r["a"])(V,z,F,!1,null,"0e51e0a8",null)),W=U.exports,Y=n("59ca"),Z=(n("e71f"),n("ea7b"),{apiKey:"AIzaSyDsB0ln_z2hJjtfMP5-GEJQ5PXt7Jzt-6I",authDomain:"test-3-823c0.firebaseapp.com",databaseURL:"https://test-3-823c0.firebaseio.com",projectId:"test-3-823c0",storageBucket:"test-3-823c0.appspot.com",messagingSenderId:"771424915652",appId:"1:771424915652:web:3ba19ec04dc968d83af991"});Y["initializeApp"](Z);var K=Y["firestore"]().collection("live-chat"),Q=Y["auth"](),X={data:function(){return{isOpen:!1,isNewMsg:!1,isRender:!1,unsubscribeDB:null,chatID:null,infoAlert:{show:!1,text:"",type:""},chat:[]}},components:{ChatToggle:O,ChatHead:j,ChatList:R,ChatInfo:H,ChatFooter:W},mounted:function(){var t=localStorage.getItem("chat-id");t&&(this.chatID=t,this.subscribeDB())},beforeDestroy:function(){this.unsubscribeDB&&this.unsubscribeDB()},methods:{openChat:function(){this.isOpen=!this.isOpen,this.isOpen&&(this.isNewMsg=!1,this.allMsgRead())},renderChat:function(){this.isRender=!0},sendMsg:function(t){var e=this,n={text:t,date:Date.now(),id:Date.now(),author:"user",read:!1};this.chatID?K.doc(this.chatID).update({chat:[].concat(Object(g["a"])(this.chat),[n])}).then((function(){e.infoAlert.show&&(e.infoAlert.show=!1)})).catch((function(t){console.log("DB error",t),e.infoAlert={show:!0,text:"Data base error",type:"error"}})):K.add({chat:[].concat(Object(g["a"])(this.chat),[n])}).then((function(t){e.chatID=t.id,localStorage.setItem("chat-id",t.id),e.subscribeDB(),e.infoAlert.show&&(e.infoAlert.show=!1)})).catch((function(t){console.log("DB error",t),e.infoAlert={show:!0,text:"Data base error",type:"error"}}))},allMsgRead:function(){var t=this;this.chat.some((function(t){return"admin"===t.author&&!t.read}))&&K.doc(this.chatID).update({chat:this.chat.map((function(t){return"admin"===t.author?Object(_["a"])(Object(_["a"])({},t),{},{read:!0}):t}))}).then((function(){t.infoAlert.show&&(t.infoAlert.show=!1)})).catch((function(e){console.log("DB error",e),t.infoAlert={show:!0,text:"Data base error",type:"error"}}))},subscribeDB:function(){var t=this;this.chatID&&(this.unsubscribeDB=K.doc(this.chatID).onSnapshot((function(e){e.exists?(t.chat=e.data().chat,!t.isOpen&&t.chat.some((function(t){return"admin"===t.author&&!t.read}))?t.isNewMsg=!0:t.isOpen&&t.allMsgRead()):(t.chat=[],t.chatID=null,localStorage.removeItem("chat-id"))})))}}},q=X,tt=(n("8677"),n("e38c"),Object(r["a"])(q,f,v,!1,null,"06a27906",null)),et=tt.exports,nt={components:{LiveChat:et}},at=nt,st=(n("6ae8"),Object(r["a"])(at,d,p,!1,null,"654fa214",null)),it=st.exports,ct=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("AdminLiveChat")],1)},ot=[],rt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"admin-live-chat"},[n("div",{staticClass:"admin-head"},[n("div",{staticClass:"admin-head__header"},[n("span",[n("router-link",{staticClass:"admin-head__btn-header",attrs:{to:"/"}},[t._v("Home page")]),n("span",{staticClass:"admin-head__title"},[t._v("Admin panel")])],1),t.isAuth?n("button",{staticClass:"livechat-btn admin-head__btn-header",on:{click:t.signOut}},[t._v(" Logout ")]):t._e()])]),t.isAuth?n("div",{staticClass:"admin-panel"},[n("AdminChatList",{attrs:{loadingDB:t.loadingDB,chatList:t.chatList,openChatId:t.openChatId},on:{"open-chat-id-set":t.openChatIdSet}}),n("AdminOpenChat",{attrs:{openChatGet:t.openChatGet},on:{"send-msg":t.sendMsg,"delete-chat":t.deleteChat}})],1):n("div",{staticClass:"admin-login"},[n("div",{staticClass:"admin-login__box"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.login,expression:"login"}],staticClass:"admin-login__input",attrs:{type:"text",placeholder:"Login"},domProps:{value:t.login},on:{input:function(e){e.target.composing||(t.login=e.target.value)}}}),n("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],staticClass:"admin-login__input",attrs:{type:"password",placeholder:"Password"},domProps:{value:t.password},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.signIn(e)},input:function(e){e.target.composing||(t.password=e.target.value)}}}),t.loginInfo?n("div",{staticClass:"admin-login__info"},[t._v(t._s(t.loginInfo))]):t._e(),n("button",{staticClass:"livechat-btn admin-login__btn-signin",attrs:{disabled:t.loadingAuth},on:{click:t.signIn}},[t._v(" Sign in ")])])])])},lt=[],ut=(n("7db0"),n("4160"),n("159b"),n("96cf"),n("1da1")),ht=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"admin-panel__chat-list"},[t.loadingDB?n("div",{staticClass:"admin-panel__loading-db"},[n("Loading")],1):t.chatList.length?n("ul",{staticClass:"admin-panel__chat-ul"},t._l(t.chatList,(function(e){return n("li",{key:e.id,staticClass:"admin-panel__chat-li",class:{"admin-panel__chat-li_active":e.id===t.openChatId,"admin-panel__chat-li_new-msg":t.checkNewMsg(e)},on:{click:function(n){return t.$emit("open-chat-id-set",e.id)}}},[t._v(" "+t._s(e.id)+" ")])})),0):n("div",{staticClass:"admin-panel__no-chat"},[t._v("No chats")])])},dt=[],pt=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},ft=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"lds-ring"},[n("div"),n("div"),n("div"),n("div")])}],vt=(n("7edc"),{}),_t=Object(r["a"])(vt,pt,ft,!1,null,"476d957d",null),gt=_t.exports,mt={props:["loadingDB","chatList","openChatId"],components:{Loading:gt},methods:{checkNewMsg:function(t){return t.id!==this.openChatId&&t.chat.some((function(t){return"user"===t.author&&!t.read}))}}},bt=mt,Ct=(n("87e5"),Object(r["a"])(bt,ht,dt,!1,null,"3ab06f5c",null)),wt=Ct.exports,xt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"admin-panel__open-chat"},[t.openChatGet.success?n("div",{staticClass:"admin-panel__chat-box"},[n("div",{staticClass:"admin-panel__head-chat"},[n("button",{staticClass:"livechat-btn admin-panel__btn-del-chat",attrs:{title:"Delete chat"},on:{click:function(e){return t.deleteChat(t.openChatGet.id)}}},[t._v(" Delete chat ")])]),n("ChatList",{attrs:{chat:t.openChatGet.chat,showRead:!0}}),n("ChatFooter",{on:{"send-msg":t.sendText}})],1):n("div",{staticClass:"admin-panel__select-chat"},[t._v("Please select chat")])])},Ot=[],Dt={props:["openChatGet"],components:{ChatList:R,ChatFooter:W},methods:{sendText:function(t){this.$emit("send-msg",t)},deleteChat:function(t){this.$emit("delete-chat",t)}}},At=Dt,yt=(n("ae65"),Object(r["a"])(At,xt,Ot,!1,null,"0611ebc0",null)),It=yt.exports,jt={data:function(){return{isAuth:!1,unsubscribeAuth:null,unsubscribeDB:null,loadingAuth:!1,loadingDB:!1,login:"",password:"",loginInfo:"",chatList:[],openChatId:null}},components:{AdminChatList:wt,AdminOpenChat:It},mounted:function(){this.subscribeAuth()},beforeDestroy:function(){this.unsubscribeAuth&&this.unsubscribeAuth(),this.unsubscribeDB&&this.unsubscribeDB()},computed:{openChatGet:function(){var t=this,e=this.chatList.find((function(e){return e.id===t.openChatId}));return e?Object(_["a"])(Object(_["a"])({},e),{},{success:!0}):{success:!1}}},methods:{signIn:function(){var t=this;return Object(ut["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.loadingAuth=!0,e.prev=1,e.next=4,Q.signInWithEmailAndPassword(t.login,t.password);case 4:t.loadingAuth=!1,e.next=12;break;case 7:e.prev=7,e.t0=e["catch"](1),t.loginInfo=e.t0.message,t.loadingAuth=!1,console.log("Auth error",e.t0);case 12:case"end":return e.stop()}}),e,null,[[1,7]])})))()},signOut:function(){var t=this;Q.signOut().then((function(){t.loginInfo=""})).catch((function(t){console.log("Auth error",t)}))},subscribeAuth:function(){var t=this;this.unsubscribeAuth=Q.onAuthStateChanged((function(e){e?(t.isAuth=!0,t.subscribeDB()):t.isAuth=!1}))},sendMsg:function(t){var e=this.openChatGet;e.success&&K.doc(e.id).update({chat:[].concat(Object(g["a"])(e.chat),[{text:t,date:Date.now(),id:Date.now(),author:"admin",read:!1}])}).catch((function(t){console.log("DB error",t)}))},deleteChat:function(t){K.doc(t).delete().catch((function(t){console.log("DB error",t)}))},subscribeDB:function(){var t=this;this.loadingDB=!0,this.unsubscribeDB=K.onSnapshot((function(e){var n=[];e.forEach((function(t){n.push(Object(_["a"])(Object(_["a"])({},t.data()),{},{id:t.id}))})),t.chatList=n.sort((function(t,e){var n=t.chat[t.chat.length-1]&&t.chat[t.chat.length-1].date||0,a=e.chat[e.chat.length-1]&&e.chat[e.chat.length-1].date||0;return a-n})),t.loadingDB&&(t.loadingDB=!1),t.allMsgRead()}))},openChatIdSet:function(t){this.openChatId===t?this.openChatId=null:(this.openChatId=t,this.allMsgRead())},allMsgRead:function(){var t=this.openChatGet;t.success&&t.chat.some((function(t){return"user"===t.author&&!t.read}))&&K.doc(t.id).update({chat:t.chat.map((function(t){return"user"===t.author?Object(_["a"])(Object(_["a"])({},t),{},{read:!0}):t}))}).catch((function(t){console.log("DB error",t)}))}}},kt=jt,Bt=(n("413b"),Object(r["a"])(kt,rt,lt,!1,null,"59af47e0",null)),Lt=Bt.exports,Mt={components:{AdminLiveChat:Lt}},$t=Mt,Et=Object(r["a"])($t,ct,ot,!1,null,null,null),Rt=Et.exports;a["a"].use(h["a"]);var St=new h["a"]({routes:[{path:"/",component:it},{path:"/admin",component:Rt}]});a["a"].config.productionTip=!1,new a["a"]({router:St,render:function(t){return t(u)}}).$mount("#app")},5924:function(t,e,n){},"6ae8":function(t,e,n){"use strict";var a=n("fa47"),s=n.n(a);s.a},"71a2":function(t,e,n){},"7edc":function(t,e,n){"use strict";var a=n("3a3f"),s=n.n(a);s.a},"85ec":function(t,e,n){},8677:function(t,e,n){"use strict";var a=n("2fb3"),s=n.n(a);s.a},"87e5":function(t,e,n){"use strict";var a=n("4f97"),s=n.n(a);s.a},"8a5d":function(t,e,n){},"9d1f":function(t,e,n){},ae65:function(t,e,n){"use strict";var a=n("d7d9"),s=n.n(a);s.a},b26d:function(t,e,n){"use strict";var a=n("71a2"),s=n.n(a);s.a},c885:function(t,e,n){"use strict";var a=n("0dd7"),s=n.n(a);s.a},c8e3:function(t,e,n){"use strict";var a=n("3043"),s=n.n(a);s.a},cce6:function(t,e,n){"use strict";var a=n("5924"),s=n.n(a);s.a},cf16:function(t,e,n){"use strict";var a=n("9d1f"),s=n.n(a);s.a},d7d9:function(t,e,n){},e38c:function(t,e,n){"use strict";var a=n("8a5d"),s=n.n(a);s.a},fa47:function(t,e,n){}});
//# sourceMappingURL=app.0ab2e8db.js.map